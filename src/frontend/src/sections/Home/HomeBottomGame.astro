<script>
  import Canvas from '../../components/spaceGame/'

  // Use Intersection Observer to see if container is sight\

  document.addEventListener('astro:page-load', () => {
    const canvas = new Canvas()

    const observer = new IntersectionObserver(
      // eslint-disable-next-line @typescript-eslint/no-unused-vars
      (entries, _observer) => {
        entries.forEach((entry) => {
          if (entry.isIntersecting) {
            canvas.init()
          } else {
            console.log('out of view')
            canvas.stopListeners()
          }
        })
      },
      { threshold: 0.5 }
    )

    observer.observe(document.querySelector('#canvas-container') as Element)
  })
</script>

<div id='canvas-container' class='container'>
  <canvas id='canvas'></canvas>
  <div class='keys'>
    <span id='up' class='key up'>▲</span><span id='left' class='key left'
      >◀</span
    ><span id='down' class='key down'>▼</span><span id='right' class='key right'
      >▶</span
    >
  </div>
</div>

<style>
  .container {
    position: relative;
    width: 100%;
    height: 100%;
    margin-top: 5px;
    background: linear-gradient(88deg, #efefef, #e7e7e7);
  }

  canvas {
    max-height: 500px;
  }

  .keys {
    position: block;
    background: linear-gradient(88deg, #efefef, #e7e7e7);
    bottom: 1em;
    text-align: center;
    font-size: 25px;
    width: 100%;
    margin-left: (5em * 3 + 0, 4rem * 6) / -2;
    &:hover {
      .key {
        background-color: rgba(white, 0.3);
      }
    }

    .key {
      margin: 0 0.4rem;
      display: inline-block;
      line-height: 2.5em;
      width: 5em;
      border-radius: 0.4em;
      background-color: rgba(white, 0.15);

      &.up {
        margin: 0 5em 0.4rem * 2;
      }
      &:hover,
      &.is-down {
        background-color: rgba(#27d49c, 0.7);
        color: white;
      }
    }
  }
</style>
